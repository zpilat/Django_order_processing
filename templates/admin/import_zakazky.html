{% extends "admin/base_site.html" %}
{% load custom_filters%}

{% block extrahead %}
  {{ block.super }}
  <script src="https://unpkg.com/htmx.org@1.9.12"></script>
{% endblock %}

{% block content %}
<div id="content" class="flex">
  {% if errors %}
    <ul class="errorlist">
      {% for err in errors %}
        <li>{{ err }}</li>
      {% endfor %}
    </ul>
  {% endif %}

  {% if warnings %}
    <ul class="messagelist">
      {% for w in warnings %}
        <li class="warning">{{ w }}</li>
      {% endfor %}
    </ul>
  {% endif %}

  <form id="import-form" method="post" enctype="multipart/form-data" novalidate>
  {% csrf_token %}
  <div id="tmp-token-slot">
    {% if tmp_token %}
      <input type="hidden" name="tmp_token" value="{{ tmp_token }}" />
    {% endif %}
  </div>
  <div class="module aligned">
      <fieldset class="module aligned">
      <div class="form-row">
          {{ form.file.errors }}
          <label for="{{ form.file.id_for_label }}">{{ form.file.label }}</label>
          <span style="display:flex;gap:8px;align-items:center;">
            {{ form.file|add_class:"vTextField" }}
            <span id="file-hint" class="help">
              {% if tmp_filename %}
                Vybraný soubor: <strong>{{ tmp_filename }}</strong> (ponecháte-li prázdné, použije se tento)
              {% endif %}
            </span>
          </span>
      </div>
      </fieldset>
  </div>

  <div class="submit-row">
  <button id="preview-btn" type="button" name="preview" value="1" class="default"
          hx-post="."
          hx-include="#import-form"
          hx-encoding="multipart/form-data"
          hx-target="#preview-container"
          hx-swap="innerHTML">
    Náhled
  </button>
  <input type="submit" value="Importovat" class="default">
  </div>
  </form>

  <div id="preview-container">
    {% if preview %}
      {% include "admin/_import_zakazky_preview.html" %}
    {% endif %}
  </div>
</div>
{% endblock %}

