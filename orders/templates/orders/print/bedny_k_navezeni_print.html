{% load custom_filters %}
<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="utf-8">
  <title>Bedny k navezení – tisk</title>
  <style>
    @page { size: A4 portrait; margin: 12mm; }
    :root {
      --primary: #7c7c7cff;
      --accent: #ffffffff;
      --text: #111;
      --border: #c7c7c7;
    }
    * { box-sizing: border-box; }
    body { font-family: 'Segoe UI', Tahoma, Arial, sans-serif; color: var(--text); margin: 0; }
    header { padding: 6px 8px 10px; margin: 0 0 8px 0; }
    header h1 { margin: 0 0 4px 0; font-size: 18px; color: var(--primary); }
    header .meta { font-size: 12px; color: #555; }
    table { width: 100%; border-collapse: collapse; }
    thead th { background: var(--accent); color: var(--primary); font-size: 14px; border: 1px solid var(--border); padding: 6px 8px; }
    tbody th { background: var(--accent); color: var(--primary); text-align: left; border: 1px solid var(--border); padding: 6px 8px; }
    td { border: 1px solid var(--border); padding: 6px 8px; font-size: 12px; }
    .pozice-cell { background: var(--primary); color: var(--accent); font-weight: 600; text-align: center; }
    .text-center { text-align: center; }
    tr.border-top td,
    tr.border-top th { border-top: 1px solid var(--primary); }
    tr.border-group-top td,
    tr.border-group-top th { border-top: 2px solid var(--text); }

    /* Zabrání nevhodnému lámání uvnitř jedné zakázky */
    tbody.zakazka-group { break-inside: avoid; page-break-inside: avoid; }

    @media screen {
      body { padding: 6px; }
    }
  </style>
</head>
<body>
  <header>
    <h4 class="text-center">Přehled beden k navezení vygenerován: {{ current_time|date:"d.m.Y H:i" }}</h4>
  </header>
  {% if groups %}
    <table class="group-table">
      <thead>
        <tr class="text-center">
          <th>Pozice</th>
          <th>Artikl</th>
          <th>Zák.</th>
          <th>Rozměr</th>
          <th>Pozn. k navezení</th>
          <th>Č. bedny</th>
          <th>Navezeno?</th>
        </tr>
      </thead>
      {% for group in groups %}
        <tbody class="group-body">
          <tr class="border-group-top"></tr>
        </tbody>
        {% for zakazka_group in group.zakazky_group %}
          {% with bedny_list=zakazka_group.bedny %}
            <tbody class="zakazka-group">
              {% for bedna in bedny_list %}
                <tr class="text-center{% if forloop.first %} border-top{% endif %}">
                  {% if forloop.first %}
                    <td rowspan="{{ bedny_list|length }}" style="font-weight: bold; font-size: 14px;">
                      {{ group.pozice|default:"-" }}
                      {% if zakazka_group.poradi %}
                        <span style="font-size: 10px; font-weight: normal;">({{ zakazka_group.poradi }})</span>
                        {% if zakazka_group.poradi == 1 %}
                          <br>
                          <span style="font-size: 12px; font-weight: normal;">(KE ZDI)</span>
                        {% endif %}                        
                      {% endif %}
                    </td>
                    <td rowspan="{{ bedny_list|length }}" style="font-weight: bold; font-size: 14px;">{{ zakazka_group.zakazka.artikl }}</td>
                    <td rowspan="{{ bedny_list|length }}">{{ zakazka_group.zakazka.kamion_prijem.zakaznik.zkratka }}</td>
                    <td rowspan="{{ bedny_list|length }}">{{ zakazka_group.zakazka.prumer }} x {{ zakazka_group.zakazka.delka }}</td>
                    <td rowspan="{{ bedny_list|length }}" class="text-center" style="font-weight: bold;">{{ bedna.poznamka_k_navezeni|default:"vše" }}</td>
                    <td style="background: var(--border);"><span style="font-weight: bold;">{{ bedna.cislo_bedny }}</span>{% if bedna.behalter_nr %} ({{ bedna.behalter_nr }}){% endif %}</td>
                    <td></td>                  
                  {% else %}
                    <td><span style="font-weight: bold;">{{ bedna.cislo_bedny }}</span>{% if bedna.behalter_nr %} ({{ bedna.behalter_nr }}){% endif %}</td>
                    <td></td>     
                  {% endif %}             
                </tr>
              {% endfor %}
            </tbody>
          {% endwith %}
        {% endfor %}
      {% endfor %}
    </table>
  {% else %}
    <table>
      <tbody>
        <tr>
          <th colspan="8" class="text-center">Žádné bedny ve stavu K_NAVEZENI.</th>
        </tr>
      </tbody>
    </table>
  {% endif %}
</body>
</html>
