{% load custom_filters %}
<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="utf-8">
  <title>Bedny k navezení – tisk</title>
  <style>
    @page { size: A4 landscape; margin: 12mm; }
    :root {
      --primary: #214290;
      --accent: #ffde17;
      --text: #111;
      --border: #c7c7c7;
    }
    * { box-sizing: border-box; }
    body { font-family: 'Segoe UI', Tahoma, Arial, sans-serif; color: var(--text); margin: 0; }
    header { padding: 6px 8px 10px; margin: 0 0 8px 0; }
    header h1 { margin: 0 0 4px 0; font-size: 18px; color: var(--primary); }
    header .meta { font-size: 12px; color: #555; }
  table { width: 100%; border-collapse: collapse; }
    thead th { background: var(--accent); color: var(--primary); font-size: 14px; border: 1px solid var(--border); padding: 6px 8px; }
    tbody th { background: var(--accent); color: var(--primary); text-align: left; border: 1px solid var(--border); padding: 6px 8px; }
    td { border: 1px solid var(--border); padding: 6px 8px; font-size: 12px; }
    .subhead th { background: var(--primary); color: var(--accent); text-align: center; }
    .spacer { height: 6px; }
    .text-center { text-align: center; }
    .border-top { border-top: 2px solid var(--primary); }

  /* Zabraň nepěkným lomům uvnitř tabulek/řádků */
  table, tr, td, th { break-inside: avoid; page-break-inside: avoid; }
  /* Drž tabulku skupiny pohromadě, zalom až když se nevejde */
  .group-table { break-inside: avoid; page-break-inside: avoid; }

    @media screen {
      body { padding: 12px; }
    }
  </style>
</head>
<body>
  {% if groups %}
    {% for group in groups %}
      <table class="group-table">
        <tbody>
          <tr>
            <th colspan="6">POZICE {{ group.pozice }}</th>
          </tr>
          <tr class="subhead">
            <th>Artikl</th>
            <th>Číslo bedny</th>
            <th>Č.b. zák.</th>
            <th>Rozměr</th>
            <th>Popis</th>
            <th>Poznámka k navezení</th>
          </tr>
          {% for zakazka_group in group.zakazky_group %}
            {% for bedna in zakazka_group.bedny %}
              {% if forloop.first %}
                <tr class="border-top">
              {% else %}
                <tr>
              {% endif %}
                  {% if forloop.first %}
                    <td rowspan="{{ zakazka_group.bedny|length }}">{{ zakazka_group.zakazka.artikl }}</td>
                  {% endif %}
                  <td>{{ bedna.cislo_bedny }}</td>
                  <td>{{ bedna.behalter_nr }}</td>
                  <td>{{ zakazka_group.zakazka.prumer }} x {{ zakazka_group.zakazka.delka }}</td>
                  <td>{{ zakazka_group.zakazka.popis }}</td>
                  <td>{{ bedna.poznamka_k_navezeni|default:"" }}</td>
                </tr>
            {% endfor %}
          {% endfor %}
        </tbody>
      </table>
    {% endfor %}
  {% else %}
    <table>
      <tbody>
        <tr>
          <th colspan="5" class="text-center">Žádné bedny ve stavu K_NAVEZENI.</th>
        </tr>
      </tbody>
    </table>
  {% endif %}
  <br>
  <footer>
    <div class="meta">Přehled beden k navezení vygenerován: {{ current_time|date:"d.m.Y H:i" }}</div>
  </footer>
</body>
</html>
